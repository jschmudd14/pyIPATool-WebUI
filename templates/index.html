{% extends "layout.html" %}

{% block content %}
<section id="auth-section" class="card">
  <h2>Authentication</h2>
  <form id="login-form" class="form-grid">
    <label>Email
      <input type="email" name="email" required>
    </label>
    <label>Password
      <input type="password" name="password" required>
    </label>
    <p id="auth-code-message" class="hint" hidden>Two-factor authentication required. Enter the code Apple just sent and submit again.</p>
    <button type="submit">Sign In</button>
  </form>
  <button id="logout-button" class="secondary" hidden>Sign Out</button>
  <div id="account-info" class="status-box" hidden>
    <h3>Active Account</h3>
    <dl>
      <dt>Name</dt><dd data-field="name">N/A</dd>
      <dt>Email</dt><dd data-field="email">N/A</dd>
      <dt>Storefront</dt><dd data-field="storeFront">N/A</dd>
    </dl>
  </div>
</section>

<section class="card" id="app-finder-section" hidden>
  <h2>Find App</h2>
  <div class="tab-group">
    <button type="button" class="tab-btn active" data-tab="search">Search Store</button>
    <button type="button" class="tab-btn" data-tab="direct">Direct Lookup</button>
  </div>
  
  <div id="search-tab" class="tab-content active">
    <form id="search-form" class="form-inline">
      <input type="text" name="term" placeholder="Search for an app..." required>
      <label>Limit
        <input type="number" name="limit" value="3" min="1" max="50">
      </label>
      <label class="checkbox">
        <input type="checkbox" name="includeTvos" id="tvos-checkbox"> Include tvOS
      </label>
      <button type="submit">Search</button>
    </form>
    <p id="tvos-hint" class="hint" style="margin-top: 1rem;" hidden>ðŸ’¡ Tip: Searching with tvOS enabled finds tvOS apps, but versions shown will be iOS by default. Use Direct Lookup with a tvOS Version ID to view related tvOS versions.</p>
    <div id="search-results" hidden></div>
  </div>

  <div id="direct-tab" class="tab-content">
    <form id="direct-lookup-form" class="form-grid">
      <label>App ID
        <input type="number" name="appId" placeholder="123456789">
      </label>
      <p class="hint center">â€” OR â€”</p>
      <label>Bundle Identifier
        <input type="text" name="bundleId" placeholder="com.example.app">
      </label>
      <div style="border-top: 1px solid rgba(148, 163, 184, 0.2); margin: 0.5rem 0;"></div>
      <label>Version ID (optional filter)
        <input type="text" name="externalVersionId" placeholder="Filter by specific version ID">
      </label>
      <p class="hint">Provide an App ID or Bundle ID above. Optionally add a Version ID to filter related versions.</p>
      <button type="submit">Load Versions</button>
    </form>
  </div>
</section>

<section class="card" id="versions-section" hidden>
  <div class="section-header">
    <div>
      <h2 id="app-title">App Versions</h2>
      <p id="app-subtitle" class="subtitle"></p>
    </div>
    <button type="button" id="purchase-license-btn" class="secondary small">Acquire License</button>
  </div>
  <div id="versions-list"></div>
</section>

<div id="auth-modal" class="modal" hidden>
  <form id="auth-modal-form" class="modal-content">
    <h3>Verification Required</h3>
    <p id="auth-modal-message">Enter the verification code Apple just sent to continue.</p>
    <label>Auth Code
      <input id="auth-modal-input" type="text" inputmode="numeric" autocomplete="one-time-code" placeholder="123456" maxlength="8" minlength="4" required>
    </label>
    <p id="auth-modal-error" class="error-text" hidden></p>
    <div class="modal-actions">
      <button type="button" id="auth-modal-cancel" class="secondary">Cancel</button>
      <button type="submit">Verify</button>
    </div>
  </form>
</div>

<div id="purchase-modal" class="modal" hidden>
  <div class="modal-content">
    <h3>Acquire License</h3>
    <p>This will purchase a free license for this app if you don't already own it.</p>
    <form id="purchase-modal-form" class="form-grid">
      <input type="hidden" name="appId" id="purchase-app-id">
      <input type="hidden" name="bundleId" id="purchase-bundle-id">
      <div class="modal-actions">
        <button type="button" id="purchase-modal-cancel" class="secondary">Cancel</button>
        <button type="submit">Acquire</button>
      </div>
    </form>
  </div>
</div>

<section id="toast" hidden></section>

<div id="download-progress" class="download-progress" hidden>
  <div class="download-progress-spinner"></div>
  <div>
    <div id="download-progress-text" class="download-progress-text">Downloading...</div>
    <div id="download-progress-filename" class="download-progress-filename" hidden></div>
  </div>
</div>
{% endblock %}
